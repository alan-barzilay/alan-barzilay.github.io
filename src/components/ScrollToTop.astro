---
// Scroll-to-top button
import ChevronDown from "../images/SVGs/chevron-down.svg";
---

<button
    id="scroll-to-top"
    aria-label="Scroll to top"
    title="Back to top"
    class="fixed bottom-8 right-8 z-30
        flex h-12 w-12 items-center justify-center
        rounded-full border-2 border-white/20 bg-dark-grey
        text-white cursor-pointer
        transition-all duration-300 ease-in-out
        
        /* Initial State: Hidden and pushed down */
        invisible opacity-0 translate-y-24
        
        /* Visible State (triggered by JS adding '.visible' class) */
        [&.visible]:visible [&.visible]:opacity-100 [&.visible]:translate-y-0
        
        /* Hover State */
        hover:scale-110
        
        /* Active State */
        active:scale-95"
>
    <ChevronDown class="h-6 w-6 rotate-180" />
</button>

<script>
    const scrollToTopButton = document.getElementById("scroll-to-top");

    let lastScrollY = window.scrollY;
    let ticking = false;
    const mediaQuery = window.matchMedia("(max-width: 600px)");

    function update() {
        const currentScrollY = window.scrollY;
        const isSmallScreen = mediaQuery.matches;

        // Basic visibility check based on scroll position
        if (currentScrollY > 300) {
            if (isSmallScreen) {
                // On small screens: hide on scroll down, show on scroll up
                if (currentScrollY > lastScrollY) {
                    // Scrolling down
                    scrollToTopButton?.classList.remove("visible");
                } else {
                    // Scrolling up
                    scrollToTopButton?.classList.add("visible");
                }
            } else {
                // On large screens: always show if scrolled past 300px
                scrollToTopButton?.classList.add("visible");
            }
        } else {
            // Always hide if near top
            scrollToTopButton?.classList.remove("visible");
        }

        lastScrollY = currentScrollY;
        ticking = false;
    }

    function onScroll() {
        if (!ticking) {
            window.requestAnimationFrame(update);
            ticking = true;
        }
    }

    function scrollToTop() {
        window.scrollTo({
            top: 0,
            behavior: "smooth",
        });
    }

    window.addEventListener("scroll", onScroll);
    scrollToTopButton?.addEventListener("click", scrollToTop);

    // Check on load
    update();
</script>
